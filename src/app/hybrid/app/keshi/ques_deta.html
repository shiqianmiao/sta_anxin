<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>详情</title>
    <meta charset="utf-8">
    <meta name="keywords" content="详情" />
    <meta name="description" content="详情" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="详情">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="./css/public.css" />
    <link rel="stylesheet" href="css/Hscroll.css">
    <link rel="stylesheet" href="./css/swiper.min.css" />
    <link rel="stylesheet" href="./css/ques_deta.css" />
</head>
<body>

    <header class="header">
        <a href="#" class="header-return"></a>
        <span>详情</span>
        <a href="javascript:" class="er-btn"></a>
    </header>
    <div class="attention-p" hidden>
        <div class="ap-wrap">
            <p class="first-p">回答注意事项<img src="imgs/next.png" class="next-more" /><span class="p-close"></span></p>
            <p>1. 膝盖有积液，属于正常现象，建议暂时不要运动，伤口愈合再运现象，建议暂动。</p>
            <p>2. 现象，建议暂有积液，属于正常现象，建议暂时不要运动，伤口愈合再运现象，建议暂愈合再运现象，建议暂愈合再运现象，建议暂动。</p>
            <p>2. 现象，建议暂有积液，属于正常现象，建议暂时不要运动，伤口愈合再运现象，建议暂愈合再运现象，建议暂愈合再运现象，建议暂动。</p>
            <p>2. 现象，建议暂有积液，属于正常现象，建议暂时不要运动，伤口愈合再运现象，建议暂愈合再运现象，建议暂愈合再运现象，建议暂动。</p>
        </div>
    </div>
    <div id="Hwrap">
        <div id="Hscroll">
            <header class="Hs-header"><span class="pullDownIcon"></span><em>下拉刷新</em></header>

                <div class="poster-wrap">
                    <div class="ques-title clear">
                        <img src="imgs/head.jpg" class="ques-head-pic" />
                        <div class="title-content">
                            <span>王先生</span><time>2015-6-1</time>
                            <div class="opation-wrap" data-show='false'>
                                <div class="alert-opa borR-3">
                                    <span class="to-public">设为公开</span>
                                    <span class="to-delete">删除</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="ques-con">膝盖有积液，走路不怎么感觉到就是蹲下觉得膝盖部位发涨、麻木，站起来费劲，这是什么原因呢？</p>
                    <ul class="pic-list clear">
                        <li class="per-pic change-bg-pic" data-sort="0" data-url="imgs/er.jpg"></li>
                        <li class="per-pic change-bg-pic" data-sort="1" data-url="imgs/pic.jpg"></li>
                        <li class="per-pic change-bg-pic" data-sort="2" data-url="imgs/pic.jpg"></li>
                        <li class="per-pic change-bg-pic" data-sort="3" data-url="imgs/ks_index_top.jpg"></li>
                        <li class="per-pic change-bg-pic" data-sort="4" data-url="imgs/er.jpg"></li>
                        <li class="per-pic change-bg-pic" data-sort="5" data-url="imgs/pic.jpg"></li>
                    </ul>
                    <h3 class="hz-info-title"><img src="imgs/jiao.png" class="jiao rotate45" />患者信息</h3>
                    <section class="info-txt borR-3">
                        <h3>张三　 女　 45岁</h3>
                        <p>病情诊断：膝盖有积液，走路不怎么感觉到就是蹲下觉得膝盖部位发涨、麻木，站起来费劲，这是什么原因呢？</p>
                    </section>
                </div>

                <h2 class="reply-title-num">回复（0）</h2>
                <ul class="reply-list">
                    <li class="per-reply">
                        <header class="reply-title">
                            <img src="imgs/head.jpg" class="head-pic borR-50" />
                            <div class="txt-wrap">
                                <a href="#" class="reply-name">陈静-住院护士</a>
                                <time>2015-6-1</time>
                                <a href="#" class="delete-btn"></a>
                            </div>
                        </header>
                        <p class="reply-content"><span class="aite">@小陈-护士</span>答：膝盖有积液，属于正常现象，建议暂时不要运动，伤口愈合再运动。</p>
                        <ul class="pic-list clear add-pd">
                            <li class="per-pic change-bg-pic" data-sort="0" data-url="imgs/pic.jpg"></li>
                            <li class="per-pic change-bg-pic" data-sort="1" data-url="imgs/pic.jpg"></li>
                            <li class="per-pic change-bg-pic" data-sort="2" data-url="imgs/pic.jpg"></li>
                            <li class="per-pic change-bg-pic" data-sort="3" data-url="imgs/ks_index_top.jpg"></li>
                            <li class="per-pic change-bg-pic" data-sort="4" data-url="imgs/pic.jpg"></li>
                            <li class="per-pic change-bg-pic" data-sort="5" data-url="imgs/pic.jpg"></li>
                        </ul>
                        <div class="reply-zan">
                            <span class="pai">￥10</span>
                            <span class="hua"></span>
                        </div>
                    </li>
                    <li class="per-reply">
                        <header class="reply-title">
                            <img src="imgs/head.jpg" class="head-pic borR-50" />
                            <div class="txt-wrap">
                                <a href="#" class="reply-name">陈静-住院护士</a>
                                <time>2015-6-1</time>
                                <a href="#" class="delete-btn"></a>
                            </div>
                        </header>
                        <p class="reply-content">答：膝盖有积液，属于正常现象，建议暂时不要运动，伤口愈合再运动。</p>
                        <div class="reply-zan">
                            <span class="pai">￥10</span>
                            <span class="hua"></span>
                        </div>
                    </li>
                    <li class="per-reply">
                        <header class="reply-title">
                            <img src="imgs/head.jpg" class="head-pic borR-50" />
                            <div class="txt-wrap">
                                <a href="#" class="reply-name">陈静-住院护士</a>
                                <time>2015-6-1</time>
                                <a href="#" class="delete-btn"></a>
                            </div>
                        </header>
                        <p class="reply-content">答：膝盖有积液，属于正常现象，建议暂时不要运动，伤口愈合再运动。</p>
                        <div class="reply-zan">
                            <span class="pai">￥10</span>
                            <span class="hua"></span>
                        </div>
                    </li>
                </ul>

            <footer class="Hs-footer"><span class="pullUpIcon"></span><em>上拉加载更多</em></footer>
        </div>
    </div>

    <!-- Swiper -->
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <!-- <div class="swiper-slide flex-center">Slide 1</div> -->
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
    </div>

    <div class="reply-box">
        <div class="reply-input borR-3" contenteditable="true"></div>
        <span class="reply-btn borR-3">回复</span>
    </div>

    <!-- 二维码弹窗 -->
    <div class="alert-mark flex-center window-hide er-close-mark" id="er-window" >
        <img src="imgs/er.jpg" class="erpic" />
    </div>
    <!-- 二维码弹窗 结束 -->
    
    <script src="http://s1.anxinsta.com/com/mobile/g.js"></script>
    <script src="http://s1.anxinsta.com/com/mobile/config.js"></script>
    <script>
    G.use(['zepto', 'widget/clientCheck/js/clientCheck.js', 'lib/swiper/swiper.min.js', 'widget/Hscroll/js/Hscroll2.js'], function($, Client, Swiper, Hscroll){

        // 加载更多
        $('.load-more').on('touchend', function () {
            $(this).find('img').show();
            $(this).find('span').html('加载中...');
            // 发送ajax请求
            
        });

        // 处理图像
        $('.change-bg-pic').each(function(i, o){
            var sourceUrl = 'url(' + $(this).data('url') + ') no-repeat center center';
            $(this).css({background: sourceUrl, backgroundSize: 'cover'});
        });

        var preArr = [];
        var nextArr = [];
        var $piclist = null;
        var thisSort = 0;
        // 当点击图片的时候
        $('.per-pic').on('tap', function(){
            // 初始化查看图片的滚动
            var swiper = new Swiper('.swiper-container', {
                pagination: '.swiper-pagination',
                paginationClickable: true
            });
            $('.swiper-container').show();
            // 收集该图片集的所有图片
            $piclist = $(this).parent().find('.per-pic');
            preArr = [];
            nextArr = [];
            thisSort = $(this).data('sort');
            $('.swiper-wrapper').append('<div class="swiper-slide flex-center"><img src="' + $(this).data('url') + '" /></div>');

            $piclist.each(function(i, o){
                if(i < thisSort){
                    preArr.push('<div class="swiper-slide flex-center"><img src="' + $(o).data('url') + '" /></div>');
                }else if(i > thisSort){
                    nextArr.push('<div class="swiper-slide flex-center"><img src="' + $(o).data('url') + '" /></div>');
                }
            });

            if(preArr.length != 0){
                swiper.prependSlide(preArr.reverse());
            }
            if(nextArr.length != 0){
                swiper.appendSlide(nextArr);
            }

            $('.swiper-container').on('click', function(){
                $(this).hide();
                $('.swiper-wrapper').empty();
                swiper.destroy();
                $('.swiper-container').off('click');
            });
            
        });

        

        var system = Client.client.system;
        if(system.iphone){
            // 是iphone,增加头部高度
            $('.header').addClass('ios-header');
        }else{
            $('.header').removeClass('ios-header');
        }
        // 点击头部二维码btn，弹出二维码弹窗
        $('.er-btn').on('tap', function(){
            alertWin('#er-window', '.er-close-mark');
        });
        
        $('.erpic').on('tap', function(event){
            if(event.stopPropagation){
                event.stopPropagation();
            }else{
                event.cancelBubble = true;
            }
        });

        // 弹窗
        function alertWin(winSelector, closeSelector){
            $(winSelector).removeClass('window-hide');
            $(closeSelector).on('tap', function(){
                $(winSelector).addClass('window-hide');
                $(closeSelector).off('tap');
            });
        }

        var $alertDom = null;
        // 点击操作按钮时候
        $('.opation-wrap').on('tap', function(event){
            // 先fadeIn所有
            $('.alert-opa').show();

            $alertDom = $(this).find('.alert-opa');

            if($alertDom.data('show') == true){
                $alertDom.hide();
                $alertDom.data('show', false);
            }else{
                $alertDom.show();
                $alertDom.data('show', true);
            }

            if(event.stopPropagation){
                event.stopPropagation();
            }else{
                event.cancelBubble = true;
            }
            
        });

        $(document).on('tap', function(){
            $('.alert-opa').hide();
            if($alertDom){
                $alertDom.data('show', false);
            }
            
        });

        $('.alert-opa').on('tap', function(event){
            if(event.stopPropagation){
                event.stopPropagation();
            }else{
                event.cancelBubble = true;
            }
        });


        // 点击患者详情
        $('.hz-info-title').on('tap', function(){
            $('.info-txt').toggleClass('hide');
            $('.jiao').toggleClass('rotate45');
        });

        // 当回复框获取焦点的时候
        $('.reply-input').on('focus', function(){
            // 显示提示
            $('.attention-p').css({opacity: '1', display: 'block'});
            // 设置高度
            $('#Hwrap').css({top: $('.header').height() + 30 + 'px'});
        });
        // 点击第一个p标签的时候
        $('.first-p').data('active', false);
        $('.first-p').on('tap', function(){
            if($('.first-p').data('active')){
                $('.attention-p').css({height: '30px'});
            }else{
                $('.attention-p').css({height: $('.ap-wrap').height() + 'px'});
            }
            $('.first-p').data('active', !$('.first-p').data('active'));
            // 箭头方向
            $('.next-more').toggleClass('rotate180');
        });

        // 点击关闭注意事项叉叉时
        $('.p-close').on('tap', function(event){
            // 设置高度
            $('#Hwrap').css({top: $('.header').height() + 'px'});

            $('.attention-p').css({opacity: '0', height: '30px'});
            $('.first-p').data('active', false);
            // 箭头方向
            $('.next-more').removeClass('rotate180');
            setTimeout(function(){
                $('.attention-p').css({display: 'none'});
            }, 300);

            if(event.stopPropagation){
                event.stopPropagation();
            }else{
                event.cancelBubble = true;
            }
        });

        // 只实例化对象不传配置参数的时候，指示做了一个模拟滚动，可以用来修复移动端fixed定位bug
        var hscroll = new Hscroll({
            refreshCallback : function(self){
                // 执行下拉刷新的操作

                //self.refreshEnd();
                setTimeout(function(){
                    self.refreshEnd();
                },1000);
            },
            loadMoreCallback : function(self){
                // 执行上拉加载更多的操作

                setTimeout(function(){
                    self.loadMoreEnd();
                },1000);
                //self.loadMoreEnd();
            },

            // 选择您需要的加载类型【只要下拉刷新 - onlyTop 】【只要上拉加载更多 - onlyBottom 】【两个都要 - double 】【都不要 - none 】
            opationType : 'double'

        });

        $('#Hwrap').css({top: $('.header').height() + 'px'});
        $('.attention-p').css({top: $('.header').height() + 'px'});

        // 计算输入框高度
        setInterval(function(){
            $('.reply-box').css({height: parseInt($('.reply-input').height()) + 16 + 'px' });
            console.log($('.reply-input').height());
        }, 20);
        
    });
    </script>

</body>
</html>