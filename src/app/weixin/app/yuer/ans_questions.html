<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>加入我们</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no" />

    <link rel="stylesheet" type="text/css" href="./css/public.css" />
    <link rel="stylesheet" href="./css/swiper.min.css" />
    <link rel="stylesheet" type="text/css" href="./css/ans_questions.css" />
</head>
<body>

	<!-- page1 -->
	<article id="page1" data-num="1">
		<section class="page1-sec1">
			<header class="page1-top flex-center"><p>您正在使用阿福宝宝预约月嫂服务，请回答以下几 个问题，我们能更准确的为您推荐月嫂。</p></header>
		</section>
		<section class="page1-sec2">
			<p>您的宝宝是头胎还是二胎？</p>
		</section>
		<section class="page1-sec3 flex-center">
			<div class="page1-select-wrap">
				<div class="page-select-1" data-ans="1">
					<i class="yuer first-child borR-50"></i>
					<h2>头胎</h2>
				</div>
				<div class="page-select-2" data-ans="2">
					<i class="yuer sec-child borR-50"></i>
					<h2>二胎</h2>
				</div>
			</div>
		</section>
	</article>
	<!-- page1 end -->

	<!-- page2 -->
	<article id="page2" data-num="2">
		<header class="page2-head">您的预产期</header>
		<div class="swiper-container page2-swiper-container">
	        <div class="swiper-wrapper page2-swiper-wrapper">
	            <div class="swiper-slide page2-swiper-slide">
	                <ul class="clear page2-swiper-ul">
		                <li class="active">
		                	<h3>5月</h3>
		                	<p>2015年</p>
		                </li>
		                <li>
		                	<h3>6月</h3>
		                	<p>2015年</p>
		                </li>
		                <li>
		                	<h3>7月</h3>
		                	<p>2015年</p>
		                </li>
		                <li>
		                	<h3>8月</h3>
		                	<p>2015年</p>
		                </li>
		                <li>
		                	<h3>9月</h3>
		                	<p>2015年</p>
		                </li>
	                </ul>
	            </div>
	        </div>
	        <i class="data-prev-icon"><span class="yuer"></span></i>
	        <i class="data-next-icon"><span class="yuer"></span></i>
	    </div>
	    <ul class="page2-date-list clear">
	    	<!-- <li class="active">1号</li> -->
	    	<li>1号</li>
	    	<li>2号</li>
	    	<li>3号</li>
	    	<li>14号</li>
	    	<li>16号</li>
	    	<li>1号</li>
	    	<li>2号</li>
	    	<li>3号</li>
	    	<li>14号</li>
	    	<li>16号</li>
	    	<li>1号</li>
	    	<li>2号</li>
	    	<li>3号</li>
	    	<li>14号</li>
	    	<li>16号</li>
	    	<li>1号</li>
	    	<li>2号</li>
	    	<li>3号</li>
	    	<li>14号</li>
	    	<li>16号</li>
	    	<li>1号</li>
	    	<li>2号</li>
	    	<li>3号</li>
	    	<li>14号</li>
	    	<li>16号</li>
	    	<li>1号</li>
	    	<li>2号</li>
	    	<li>3号</li>
	    	<li>14号</li>
	    	<li>16号</li>
	    </ul>

	    <footer class="page2-foot">
	    	<a href="javascript:;" class="page2-prev borR-3">上一步</a>
	    	<a href="javascript:;" class="page2-next borR-3">下一步</a>
	    </footer>
	</article>
	<!-- page2 end -->

	<!-- page3 -->
	<article id="page3" data-num="3">
		<header class="page3-head">您希望月嫂是哪里人</header>
		<section class="page3-content">
			<ul class="page3-addr-list clear">
				<li data-p3ansnum="1"><span></span><em>东北</em></li>
				<li data-p3ansnum="2"><span></span><em>西北</em></li>
				<li data-p3ansnum="3"><span></span><em>河北</em></li>
				<li data-p3ansnum="4"><span></span><em>华中</em></li>
				<li data-p3ansnum="5"><span></span><em>华东</em></li>
				<li data-p3ansnum="6"><span></span><em>华南</em></li>
				<li data-p3ansnum="7"><span></span><em>华西</em></li>
			</ul>
		</section>
		<footer class="page3-foot">
	    	<a href="#" class="page3-prev borR-3">上一步</a>
	    	<a href="#" class="page3-next borR-3">下一步</a>
	    </footer>
	</article>
	<!-- page3 end -->
	<!-- page4 -->
	<article id="page4" data-num="4">
		<header class="page4-header">请您至少选择3个感兴趣的问题</header>
		<ul class="page4-sel-list clear">
			<li data-p4ansnum="1">
				<i class="yuer yuer-page4-1"></i>
				<h3>月子餐</h3>
			</li>
			<li data-p4ansnum="2">
				<i class="yuer yuer-page4-2"></i>
				<h3>宝宝健康</h3>
			</li>
			<li data-p4ansnum="3">
				<i class="yuer yuer-page4-3"></i>
				<h3>产后恢复</h3>
			</li>
			<li data-p4ansnum="4">
				<i class="yuer yuer-page4-4"></i>
				<h3>母乳喂养</h3>
			</li>
			<li data-p4ansnum="5">
				<i class="yuer yuer-page4-5"></i>
				<h3>产后情绪</h3>
			</li>
			<li data-p4ansnum="6">
				<i class="yuer yuer-page4-6"></i>
				<h3>早期教育</h3>
			</li>
			<li data-p4ansnum="7">
				<i class="yuer yuer-page4-7"></i>
				<h3>乳房护理</h3>
			</li>
			<li data-p4ansnum="8">
				<i class="yuer yuer-page4-8"></i>
				<h3>家庭关系</h3>
			</li>
		</ul>
		<footer class="page4-foot">
	    	<a href="#" class="page4-prev borR-3">上一步</a>
	    	<a href="#" class="page4-next borR-3">下一步</a>
	    </footer>
	</article>
	<!-- page4 end -->

	<!-- page5 -->
	<article id="page5" data-num="5">
		<header class="page5-header">请您留下联系方式，我们的客服会根据您的需求尽快给您推荐合适的月嫂。</header>
		<ul class="reg-form-list tel-change-list">
			<li class="reg-per-input-wrap clear">
				<h4>姓名</h4>
				<input type="text" class="reg-tel username"/>
			</li>
			<li class="reg-per-input-wrap clear">
				<h4>手机</h4>
				<input type="text" class="reg-tel telnumber"/>
			</li>
			<li class="reg-per-input-wrap clear">
				<h4>验证码</h4>
				<input type="text" class="reg-code codenumber"/>
				<span class="getCode borR-3">获取验证码</span>
			</li>
		</ul>
		<footer class="page5-foot">
	    	<a href="#" class="page5-prev borR-3">上一步</a>
	    	<a href="#" class="page5-next borR-3">完成</a>
	    </footer>
	</article>
	
	<!-- page5 end -->

	<script src="http://s1.anxinsta.com/com/mobile/g.js"></script>
    <script src="http://s1.anxinsta.com/com/mobile/config.js"></script>
    <script>
    G.use(['zepto', 'lib/swiper/swiper.min.js', 'widget/Optionaltime/js/Optionaltime.js', 'com/mobile/widget/Hmodel/js/Hmodel.js'], function($, Swiper, Optionaltime, Hmodel){

    	// 实例化Hmodel
    	var Hmodel = new Hmodel({
			showTime : 2000
		});

		// 实例化下面的对象后，就给定了只有在 startTime ~ endTime 之间的时间是可用的
		var a = Optionaltime({
			startTime : "2015/09/15", // 时间下限
			endTime : "2016/06/30"	// 时间上限
		});

		var y = a.getYear();	// 获取可用的年份，返回的是json数据，包含min和max两个属性，分别表示最小的可用年份和最大的可用年份
		var m = a.getMonth(y.min);	// 根据年份获取可用的月份，返回的是json数据，包含min和max两个属性，分别表示最小的可用月份和最大的可用月份
		var d = a.getDay(y.min, m.min);	// 根据年份、月份获取可用的天，返回的是json数据，包含min和max两个属性，分别表示最小的可用天（即几号）和最大的可用天（即几号）

// localStorage.removeItem('answer');
    	// 全局数据存储

    	if(localStorage.getItem('answer')){
    		globalData = JSON.parse(localStorage.getItem('answer'));
    	}else{
    		var ansNum = $('article[data-num]').length,
	    		globalData = {};
	    	for(var i = 1; i < ansNum; i++){
	    		(function(i){
	    			if(i == 3 || i == 4){
		    			globalData[i] = [];
		    		}else if(i == 2){
		    			globalData[i] = "";	
		    		}else{
		    			globalData[i] = 0;
		    		}
	    		})(i);
	    	}
    	}

    	// 从第一题向后检查，哪个为空定位到哪个页面（第一道定位）

    	// 经过了第一道定位后，从最后一题检查，哪个
    	if(globalData.username && globalData[4].length && globalData[3].length && globalData[2] && globalData[1]){
    		// 全部初始化
    		// 显示第5个页面
    		showPage('#page5');

    		// 初始化页面5
    		initPage('#page5');
    		// 初始化页面4
    		initPage('#page4');
    		// 初始化页面3
    		initPage('#page3');
    		// 初始化页面2
    		initPage('#page2');
    	}else if(globalData[4].length && globalData[3].length && globalData[2] && globalData[1]){
    		// 初始化前4个
    		// 显示第4个页面
    		showPage('#page4');

    		// 初始化页面4
    		initPage('#page4');
    		// 初始化页面3
    		initPage('#page3');
    		// 初始化页面2
    		initPage('#page2');
    	}else if(globalData[3].length && globalData[2] && globalData[1]){
    		// 初始化前3个
    		// 显示第3个页面, 并初始化选项
    		showPage('#page3');

    		console.log(globalData[3]);

    		// 初始化页面3
    		initPage('#page3');
    		// 初始化页面2
    		initPage('#page2');

    	}else if(globalData[2] && globalData[1]){
    		// 初始化前2个
    		// 显示第2个页面, 并初始化选项
    		showPage('#page2');
			initPage('#page2');
    	}else if(globalData[1]){
    		// 初始化前1个
    		createDateTitle(y.min, m.min); // 调用
			createDay(y.min, m.min);
    	}else{
    		createDateTitle(y.min, m.min); // 调用
			createDay(y.min, m.min);
    	}
    	console.log(globalData);

    	// page1 js ********************************************************************

    	// 点选区域触碰是的样式
    	$('.page1-select-wrap div').on('touchstart', function(){
    		$(this).addClass('active');
    	});
    	$('.page1-select-wrap div').on('touchend', function(){
    		$(this).removeClass('active');
    	});

    	// 点选选项
    	$('.page1-select-wrap div').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 写入数据
    		globalData[quesNum] = $(this).data('ans');
    		// 写入localstorage
    		localStorage.setItem('answer', JSON.stringify(globalData));
    		
    		// 显示下一题目
    		$(quesArt).hide();	// 隐藏当前题目
    		$('article[data-num="' + (quesNum + 1) + '"]').css({left: '0'}).addClass('show');	// 显示下一题目

    		// 设置hash
    		// location.hash = 'page2';

    		console.log(localStorage.getItem('answer'));
    	});

    	// page1 js end ****************************************************************

    	// page2 js ********************************************************************
		
		// 创建标题日期
		function createDateTitle(yOpa, mOpa){
			var dateTitleStr = '',
	  			start = true;
			for(var i = y.min; i <= y.max; i++){
				var m = a.getMonth(i);
				for(var k = m.min; k <= m.max; k++){
					// console.log(i + '-' + k);

					if(yOpa == i && mOpa == k){
						dateTitleStr += '<li class="active" data-date="' + i + '-' + k + '">'
		+						        	'<h3>' + k + '月</h3>'
		+						        	'<p>' + i + '年</p>'
		+						        '</li>';
					}else{
						dateTitleStr += '<li data-date="' + i + '-' + k + '">'
		+						        	'<h3>' + k + '月</h3>'
		+						        	'<p>' + i + '年</p>'
		+						        '</li>';
					}
					
				}
			}
			$('.page2-swiper-ul').html(dateTitleStr);

			// 添加点击事件
			$('.page2-swiper-ul li').on('click', function(){
				var y = $(this).data('date').split('-')[0];
				var m = $(this).data('date').split('-')[1];
				// 样式
				$('.page2-swiper-ul li').removeClass('active');
				$(this).addClass('active');

				createDay(y, m);	// 创建可用天
			});
		}
		

		// 创建该月的可用天
		function createDay(y, m){
			// 清空
			$('.page2-date-list').html(' ');
			// 创建
			var d = a.getDay(y, m),
				dayStr = '';
			for(var i = d.min; i <= d.max; i++){
				dayStr += '<li data-pushdate="' + y + '-' + m + '-' + i + '" data-curday="' + i + '">' + i + '号</li>';
			}
			$('.page2-date-list').html(dayStr);
			// 点击事件
			$('.page2-date-list li').on('tap', function(){
				$('.page2-date-list li').removeClass('active');
				$(this).addClass('active');

				// 获取题目article标签
	    		var quesArt = $(this).parents('article');
	    		// 获取题目号
	    		var quesNum = $(this).parents('article').data('num');
	    		// 写入数据
	    		globalData[quesNum] = $(this).data('pushdate');
	    		// 写入localstorage
    			localStorage.setItem('answer', JSON.stringify(globalData));

	    		console.log(localStorage.getItem('answer'));

			});
		}
  		

    	// 计算日期ul的宽度,计算日期
    	var paddingWidth = parseInt($('.page2-swiper-ul').css('padding').split(' ')[1]) * 2;
		$('.page2-swiper-slide').css({width: $('.page2-swiper-ul li').width() * $('.page2-swiper-ul li').length - 1 + paddingWidth + 'px'});
    	// 日期滑动
        var swiper = new Swiper('.swiper-container', {
            direction: 'horizontal',
            slidesPerView: 'auto',
            mousewheelControl: true,
            freeMode: true
        });

    	// 点击上一步
    	$('.page2-prev').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 显示上一题
    		$(quesArt).removeClass('show').css({left: '100%'});	// 隐藏当前题目
    		$('article[data-num="' + (quesNum - 1) + '"]').show().addClass('show');	// 显示上一题目

    		// 设置hash
    		// location.hash = '';
    	});

    	// 点击下一步
    	$('.page2-next').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 检查该题目是否选择
    		if($('.page2-date-list li.active').length == 0){
    			Hmodel.show('请选择一个日期');
    		}else{
    			// 显示下一题
    			$(quesArt).removeClass('show').css({left: '100%'});	// 隐藏当前题目
    			$('article[data-num="' + (quesNum + 1) + '"]').show().addClass('show');	// 显示上一题目

    			// 设置hash
    			// location.hash = 'page3';
    		}
    	});
    	
    	// page2 js end ****************************************************************

    	// page3 js ********************************************************************

    	var page3ItemArr = [];
    	// 点击选项的时
    	$('.page3-addr-list li').on('tap', function(){
    		// 样式
    		$(this).toggleClass('active');

    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');

    		// 存储选项
    		page3ItemArr = [];
    		$('.page3-addr-list li.active').each(function(i, obj){
    			page3ItemArr.push($(obj).data('p3ansnum'))
    		});
    		// 写入数据
    		globalData[quesNum] = page3ItemArr;
    		// 写入localstorage
    		localStorage.setItem('answer', JSON.stringify(globalData));

    		console.log(localStorage.getItem('answer'));
    	});

    	// 点击上一步
    	$('.page3-prev').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 显示上一题
    		$(quesArt).removeClass('show').hide();	// 隐藏当前题目
    		$('article[data-num="' + (quesNum - 1) + '"]').css({left: '0'}).addClass('show');	// 显示上一题目

    		// 设置hash
    		// location.hash = 'page2';
    	});

    	// 点击下一步
    	$('.page3-next').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 检查该题目是否选择
    		if($('.page3-addr-list li.active').length == 0){
    			Hmodel.show('请选择一个地区');
    		}else{
    			// 显示下一题
    			$(quesArt).removeClass('show').hide();	// 隐藏当前题目
    			$('article[data-num="' + (quesNum + 1) + '"]').show().addClass('show');	// 显示上一题目
    			// 设置hash
    			// location.hash = 'page4';
    		}
    	});

    	// page3 js end ****************************************************************

    	// page4 js ********************************************************************

    	var page4ItemArr = [];
    	// 点击选项的时
    	$('.page4-sel-list li').on('tap', function(){
    		// 样式
    		$(this).toggleClass('active');

    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');

    		// 存储选项
    		page4ItemArr = [];
    		$('.page4-sel-list li.active').each(function(i, obj){
    			page4ItemArr.push($(obj).data('p4ansnum'))
    		});
    		// 写入数据
    		globalData[quesNum] = page4ItemArr;
    		// 写入localstorage
    		localStorage.setItem('answer', JSON.stringify(globalData));

    		console.log(localStorage.getItem('answer'));
    	});

    	// 点击上一步
    	$('.page4-prev').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 显示上一题
    		$(quesArt).removeClass('show').hide();	// 隐藏当前题目
    		$('article[data-num="' + (quesNum - 1) + '"]').show().addClass('show');	// 显示上一题目

    		// 设置hash
    		// location.hash = 'page3';
    	});

    	// 点击下一步
    	$('.page4-next').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 检查该题目是否选择
    		if($('.page4-sel-list li.active').length < 3){
    			Hmodel.show('请您至少选择3个感兴趣的问题');
    		}else{
    			// 显示下一题
    			$(quesArt).removeClass('show').hide();	// 隐藏当前题目
    			$('article[data-num="' + (quesNum + 1) + '"]').show().addClass('show');	// 显示上一题目
    			// 设置hash
    			// location.hash = 'page5';
    		}
    	});

    	// page4 js end ****************************************************************

    	// page5 js ********************************************************************
    	// 点击获取验证码
		$('.getCode').on('tap', getCodeFn);

		// 获取验证码的函数
		function getCodeFn(){
			var sec = 60,
				self = this,
				timer = null;
			$(this).addClass('getCodeing');
			$(this).off('tap');
			$(this).html(sec + '秒');

			timer = setInterval(function(){
				if(sec != 0){
					sec--;
					$(self).html(sec + '秒');
				}else{
					clearInterval(timer);
					$(self).removeClass('getCodeing');
					$(self).on('tap', getCodeFn);
					$(self).html('重新获取');
				}
				
			}, 1000);

			// 在这里发送ajax请求

		}

		// 点击上一步
    	$('.page5-prev').on('tap', function(){
    		// 获取题目article标签
    		var quesArt = $(this).parents('article');
    		// 获取题目号
    		var quesNum = $(this).parents('article').data('num');
    		// 显示上一题
    		$(quesArt).removeClass('show').hide();	// 隐藏当前题目
    		$('article[data-num="' + (quesNum - 1) + '"]').show().addClass('show');	// 显示上一题目
    		// 设置hash
    		// location.hash = 'page4';
    	});

    	// 点击完成
    	$('.page5-next').on('tap', function(){
    		// 检查是否填写姓名
    		if($.trim($('.username').val()) === ''){
    			Hmodel.show('请填写姓名');
    			return false;
    		}
    		// 检查是否填写手机号
    		if($.trim($('.telnumber').val()) === ''){
    			Hmodel.show('请填写手机号');
    			return false;
    		}
    		// 检查是否填写验证码
    		if($.trim($('.codenumber').val()) === ''){
    			Hmodel.show('请填写验证码');
    			return false;
    		}
    		// 其他检查

    		// 检查通过后组装数据提交
    		globalData['username'] = $.trim($('.username').val());
    		globalData['telnumber'] = $.trim($('.telnumber').val());
    		globalData['codenumber'] = $.trim($('.codenumber').val());

    		// 写入localstorage
    		localStorage.setItem('answer', JSON.stringify(globalData));

    		// 发送数据

    		console.log(localStorage.getItem('answer'));
    	});
    	// page5 js end ****************************************************************

		// 显示页面的函数
		function showPage(id){
			switch(id){
    			case '' :
    				$('#page1').show();
    				$('#page2').css({left: '100%'});
    				$('#page3').hide();
    				$('#page4').hide();
    				$('#page5').hide();
    			break;
    			case '#page2' :
    				$('#page1').hide();
    				$('#page2').css({left: '0'});
    				$('#page3').hide();
    				$('#page4').hide();
    				$('#page5').hide();
    			break;
    			case '#page3' :
    				$('#page1').hide();
    				$('#page2').css({left: '100%'});
    				$('#page3').show();
    				$('#page4').hide();
    				$('#page5').hide();
    			break;
    			case '#page4' :
    				$('#page1').hide();
    				$('#page2').css({left: '100%'});
    				$('#page3').hide();
    				$('#page4').show();
    				$('#page5').hide();
    			break;
    			case '#page5' :
    				$('#page1').hide();
    				$('#page2').css({left: '100%'});
    				$('#page3').hide();
    				$('#page4').hide();
    				$('#page5').show();
    			break;
    			default :
    				$('#page1').show();
    				$('#page2').css({left: '100%'});
    				$('#page3').hide();
    				$('#page4').hide();
    				$('#page5').hide();
    			break;
    		}
		}

		// 初始化页面
		function initPage(id){
			switch(id){
				case '':
				break;
				case '#page2' :
					var p2InitY = globalData[2].split('-')[0];
		    		var p2InitM = globalData[2].split('-')[1];
		    		var p2InitD = globalData[2].split('-')[2];

		    		createDateTitle(p2InitY, p2InitM); // 调用
					createDay(p2InitY, p2InitM);

					$('li[data-curday="' + p2InitD + '"]').addClass('active');
				break;
				case '#page3' :

					for(var i = 0; i < globalData[3].length; i++){
						$('li[data-p3ansnum="' + globalData[3][i] + '"]').addClass('active');
					}
					
				break;
				case '#page4' :

					for(var i = 0; i < globalData[4].length; i++){
						$('li[data-p4ansnum="' + globalData[4][i] + '"]').addClass('active');
					}

				break;
				case '#page5' :
					$('.username').val(globalData.username);
					$('.telnumber').val(globalData.telnumber);
					$('.codenumber').val(globalData.codenumber);
				break;
				default :
    			break;

			}
		}
        
    });
    </script>
</body>
</html>